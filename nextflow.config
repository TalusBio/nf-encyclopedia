// Profiles
profiles {
    standard {
        process {
            executor = 'local'
            withName: 'run_encyclopedia_.*' {
                container = 'docker-encyclopedia'
            }
            withName: 'run_msconvert' {
                container = 'docker-msconvert'
            }
            withName: 'unique_peptides_proteins' {
                container = 'docker-unique-peptides-proteins'
            }
            withName: 'msstats' {
                container = 'docker-msstats'
            }
        }
    }
    cloud {
        process {
            executor = 'awsbatch'
            errorStrategy = 'retry'
            maxRetries = 3
            withName: 'run_encyclopedia_local' {
                container = '622568582929.dkr.ecr.us-west-2.amazonaws.com/docker-encyclopedia'
                queue = 'terraform-nextflow-medium-size-spot-batch-job-queue'
                memory = 31100.MB
                cpus = 4
            }
            withName: 'run_encyclopedia_global' {
                container = '622568582929.dkr.ecr.us-west-2.amazonaws.com/docker-encyclopedia'
                queue = 'terraform-nextflow-large-size-spot-batch-job-queue'
                memory = 31100.MB
                cpus = 2
            }
            withName: 'run_msconvert' {
                container = '622568582929.dkr.ecr.us-west-2.amazonaws.com/docker-msconvert'
                queue = 'terraform-nextflow-medium-size-spot-batch-job-queue'
                memory = 7700.MB
                cpus = 2
            }
            withName: 'unique_peptides_proteins' {
                container = '622568582929.dkr.ecr.us-west-2.amazonaws.com/docker-unique-peptides-proteins'
                queue = 'terraform-nextflow-medium-size-spot-batch-job-queue'
                memory = 7700.MB
                cpus = 2
            }
            withName: 'msstats' {
                container = '622568582929.dkr.ecr.us-west-2.amazonaws.com/docker-msstats'
                queue = 'terraform-nextflow-medium-size-spot-batch-job-queue'
                memory = 15400.MB
                cpus = 2
            }
        }
    }
}

// Docker Parameters
docker {
    enabled = true
}

// Pipeline Parameters
params {
    experimentName = 'purple-pig'
    email = 'rmeinl@talus.bio'
    publish_dir = ''
    mzml_dir = ''
    //narrow_files = ''
    //wide_files = ''
    //narrow_mzml_files = ''
    //wide_mzml_files = ''
    use_msstats = true

    encyclopedia {
        fasta = ''
        dlib = ''
        memory = '-Xmx24G'
        narrow_lib_postfix = 'chr'
        wide_lib_postfix = 'quant'
        local_options = ''
        global_options = ''
    }

    msconvert {
        verbose = '-v'
        gzip = '--gzip'
        options = '--mzML --64 --zlib'
        filters = '--filter "peakPicking true 1-" --filter "demultiplex optimization=overlap_only"'
    }
}

// Plugins
plugins {
    id 'nf-amazon'
}

// AWS Setup
aws {
    region = 'us-west-2'
    client {
        storageEncryption = 'AES256'
    }
    batch {
        cliPath = '/home/ec2-user/bin/aws'
        jobRole = 'arn:aws:iam::622568582929:role/terraform-nextflow-batch-job-role'
    }
}

//includeConfig 'nextflow_run.config'